#include<stdio.h>
#include<string.h>
#include<stdlib.h>
#include<conio.h>
#include<windows.h>
#include <ctype.h>//???????
#define PWDLEN 20//???????
#define N 200
#define LEN sizeof(struct employee)
char password[7]="999999";//???????
void getpwd(char *pwd, int pwdlen);//????*?????
void Countdown();//?????
void menustrip();//?????
void inquire();//??????
void rootmenu();//????
void modification();//???
void add();//????
void count();//???
void display();//????????
void omit();//???
void import();//????
void demend();
struct employee
{
	int order;//???
	char name[20];//????
	char sex[2];//???
	int age;//????
	char identity[20];//?????
	char location[30];//???
	int phone[15];//?��
}em[N];
void main()
{ 
	int flage;
	int n=3;
	char pwd[PWDLEN+1];
	for(n=0;n<3;n++)
	{
		printf("?????????????\n");
		getpwd(pwd, PWDLEN);
		if(strcmp(pwd,password)==0)
		{
			printf("????????????\n\n\n");
			flage=1;
			break;
		}
		else
		{
			printf("?????????????????:\n");
			flage=0;
		}
	}
	if(flage==0)
	{
		printf("??????????????????\n");
		exit(0);
	}
	Countdown();
	rootmenu();
}
void getpwd(char *pwd, int pwdlen)
{
    char ch = 0;
    int i = 0;
    while(i<pwdlen)
	{
        ch = getch();
        if(ch == '\r')
		{  //???????????
            printf("\n");
            break;
        }
       
        if(ch=='\b' && i>0)
		{  //?????????
            i--;
            printf("\b \b");
        }else if(isprint(ch))
		{  //??????????
            pwd[i] = ch;
            printf("*");
            i++;
        }
    }
    pwd[i] = 0;
}
void Countdown()
{
	int i=5;
	printf("?????????????.");
	while(i>0)
	{
		printf(".");
		Sleep(500);
		i--;
	}
	printf("\n");
}
void menustrip()
{
	int a;
	system("cls");
	for(;;)
	{
		printf("*************************************************\n");
		printf("\t\t??????????????\n");
		printf("????????evil spirit\t????17242\t\n");
		printf("???????????????????????\n");
		printf("*************************************************\n");
		printf("\t\t???????????????:\n");
		printf("=================================================\n");
		printf("=\t\t1???????\t\t\t=\n");
		printf("=\t\t2??????\t\t\t=\n");
		printf("=\t\t3??????\t\t\t=\n");
		printf("=\t\t4???????\t\t\t=\n");
		printf("=\t\t5??????\t\t\t=\n");
		printf("=\t\t6???????\t\t\t=\n");
		printf("=\t\t7??????????\t\t\t=\n");
		printf("=\t\t0???\t\t\t\t=\n");
		printf("=================================================\n");
		scanf("%d",&a);
		switch(a)
		{
			case 0:break;
			case 1:import();break;
			case 2:inquire();break;
			case 3:modification();break;
			case 4:add();break;
			case 5:omit();break;
			case 6:count();break;
			case 7:rootmenu();break;
		}
		if(a==0)
			exit(0);
	}
}
void inquire()
{
	system("cls");
	{
		printf("*************************************************\n");
		printf("\t\t???????????????\n");
		printf("????????evil spirit\t????17242\t\n");
		printf("???????????????????????\n");
		printf("*************************************************\n");
		printf("\t\t????????????????\n");
		printf("=================================================\n");
		printf("=\t\t1.?? ??\t\t\t=\n");
		printf("=\t\t2.?? ??\t\t\t=\n");
		printf("=\t\t3.?? ??\t\t\t=\n");
		printf("=\t\t4.???????\t\t=\n");
		printf("=\t\t5.??????\t\t=\n");
		printf("=\t\t6.????��\t\t=\n");
		printf("=\t\t7.?????????\t\t=\n");
		printf("=\t\t8.???????\t\t=\n");
		printf("=\t\t9.?????????\t\t=\n");
		printf("=\t\t0.???\t\t\t=\n");
		printf("=================================================\n");
	}
	demend();
}
void demend()
{
	FILE*fp;
	int i;
	char choice;
	if((fp=fopen("employee.txt","r"))==NULL)
		return;
	scanf("%d",&choice);
	for(i=0;fread(&em[i],LEN,1,fp)!=0;i++)
	{
		switch(choice)
		{
			case 0:printf("�ݧ�?????????\n");break;
			case 1:printf("%s\t\n",em[i].name);break;
			case 2:printf("%s\t\n",em[i].sex);break;
			case 3:printf("%d\t\n",em[i].age);break;
			case 4:printf("%s\t\n",em[i].identity);break;
			case 5:printf("%s\t\n",em[i].location);break;
			case 6:printf("%d\t\n",em[i].phone);break;
			case 7:display();break;
			case 8:rootmenu();break;
			case 9:menustrip();break;
			default:printf("????????????\n");
		}
		if(choice==0)
			exit(0);
	}
	getch();
	inquire();
}
void rootmenu()
{
	int a;
	system("cls");
	for(;;)
	{
		printf("*************************************************\n");
		printf("\t\t?????????????\n");
		printf("????????evil spirit\t????17242\t\n");
		printf("???????????????????????\n");
		printf("*************************************************\n");
		printf("\t\t????????????????\n");
		printf("=================================================\n");
		printf("=\t\t1.?????\t\t\t=\n");
		printf("=\t\t2.?????\t\t\t=\n");
		printf("=\t\t0.?????\t\t\t=\n");
		printf("=================================================\n");
		scanf("%d",&a);
		switch(a)
		{
			case 0:break;
			case 1:menustrip();break;
			case 2:inquire();break;
		}
		if(a==0)
		{
			printf("�ݧ�?????????\n");
			exit(0);
		}
	}
}
void import()
{
	FILE*fp;
	int i=0;
	char choiceinput='y';
	if((fp=fopen("employee.txt","a+"))==NULL)
		return;
	while(choiceinput=='y'||choiceinput=='Y')
	{
		i++;
		i=em[i].order;
		printf("??%d????\n",i);
		printf("\n");
		printf("??????????????\n");
		scanf("%s",em[i].name);
		printf("\n");
		printf("?????????????��????:\n");
		scanf("%s",em[i].sex);
		printf("\n");
		printf("????????????\n");
		scanf("%d",&em[i].age);
		printf("\n");
		printf("???????????????(??????????X???????01):\n");
		scanf("%s",&em[i].identity);
		printf("\n");
		printf("???????????????:\n");
		scanf("%s",em[i].location);
		printf("\n");
		printf("???????????????��:\n");
		scanf("%d",em[i].phone);
		printf("\n");
		printf("????????????y/n??\n");
		scanf("%s",&choiceinput);
		fwrite(&em[i],LEN,1,fp);
	}
	if(toupper(choiceinput)=='N')
	{
		fclose(fp);
		printf("?????????????????\n");
		menustrip();
	}
}
void modification()
{
	FILE *fp;
	int i,j,m=0,sum;
	if((fp=fopen("employee.txt","a+"))==NULL)
	{
		printf("??????????????????????\n");
		return;
	}
	printf("??????????????????:\n");
	scanf("%d",&sum);
	while(!feof(fp))
		if(fread(&em[m],LEN,1,fp)==1)
			m++;
		if(m==0)
		{
			system("cls");
			printf("????\n");
			fclose(fp);
			return;
		}
	for(i=0;i<m;i++)
		if(sum==em[i].order)//??????????????????????
		{
			if(i<m)
			{
				printf("??%d????\n",i);
				printf("??????????????\n");
				scanf("%s",em[i].name);
				printf("?????????????��????:\n");
				scanf("%s",em[i].sex);
				printf("????????????\n");
				scanf("%d",&em[i].age);
				printf("???????????????:\n");
				scanf("%s",&em[i].identity);
				printf("???????????????:\n");//??????????
				scanf("%s",em[i].location);
				printf("???????????????��:\n");//?????��
				scanf("%s",em[i].phone);
			}
		}
		else
			{
				printf("?????????????????????");
				return;
			}
			if((fp=fopen("employee.txt","w"))==NULL)
		{
			printf("????????????????????!\n");
			return;
		}
		for(j=0;j<m;j++)//???????????��??????????????????
			if(fwrite(&em[j],LEN,1,fp)!=1)
				printf("???????????????????????\n");
			fclose(fp);
			menustrip();
}
void add()
{
	FILE *fp;
	int i,j,m=0;
	if((fp=fopen("employee.txt","a+"))==NULL)
	{
		printf("??????????????????????\n");
		return;
	}
	while(!feof(fp))
		if(fread(&em[m],LEN,1,fp)==1)
			m++;
		if(m==0)
		{
			printf("????\n");
			fclose(fp);
			return;
		}
	printf("?????????????????????\n");
	scanf("%d",&em[m].order);
	for(i=0;i<m;i++)
		if(em[m].order==em[i].order)//???????????????????????
	{
		printf("????????????????????");
		fclose(fp);
		return;
	}
	if(i>=m)
	{
		printf("??%d????\n",i);
		printf("\n");
		printf("??????????????\n");
		scanf("%s",em[i].name);
		printf("\n");
		printf("?????????????��????:\n");
		scanf("%s",em[i].sex);
		printf("\n");
		printf("????????????\n");
		scanf("%d",&em[i].age);
		printf("\n");
		printf("???????????????:\n");
		scanf("%s",&em[i].identity);
		printf("\n");
		printf("???????????????:\n");
		scanf("%s",em[i].location);
		printf("\n");
		printf("???????????????��:\n");
		scanf("%s",em[i].phone);
		printf("\n");
	}
	if((fp=fopen("employee.txt","w+"))==NULL)
	{
		printf("??????????????????!\n");
		return;
	}
	for(j=0;j<=m;j++)//???????????��??????????????????
		if(fwrite(&em[j],LEN,1,fp)!=1)
			printf("??????????????????????\n");
	fclose(fp);
	menustrip();
}
void omit()
{
	FILE *fp;
	int sum,i,j,m=0;
	char ch[2];
	if((fp=fopen("employee.txt","a+"))==NULL)
	{
		printf("????????????????????!\n");
		return;
	}
	while(!feof(fp))
		if(fread(&em[m],LEN,1,fp)==1)
			m++;
		fclose(fp);
		if(m==0)
		{
			printf("??????\n");
			return;
		}
		printf("????????????????????:");
		scanf("%d",&sum);
		for(i=0;i<m;i++)
			if(sum==em[i].order)
			{
				break;
			}
		if(i==m)
		{
			printf("??????????????????????!\n");
			return;
		}
		printf("????????(y/n)");
		scanf("%s",ch);
		if(strcmp(ch,"Y")==0||strcmp(ch,"y")==0)//?��????????????
		{
			for(j=i;j<m;j++)
				em[j]=em[j+1];//??????????????????????��??
			m--;//?????????????
			printf("????????\n");
		}
		if((fp=fopen("employee.txt","w"))==NULL)
		{
			printf("????????????????????!\n");
			return;
		}
		for(j=0;j<m;j++)//??????????????��???????????????
			if(fwrite(&em[j],LEN,1,fp)!=1)
			{
				printf("????????????????????!\n");
			}
	fclose(fp);
	menustrip();
}
void count()
{
	FILE *fp;
	int m=0;
	if((fp=fopen("employee.txt","r"))==NULL)
	{
		printf("??????????????????????\n");
		return;
	}
	while(!feof(fp))
		if(fread(&em[m],LEN,1,fp)==1)
			m++;
		if(m==0)
		{
			printf("????\n");
			fclose(fp);
			return;
		}
	printf("??????%d?????!\n",m);
	getch();
	fclose(fp);
	menustrip();
}
void display()
{
	FILE*fp;
	int i;
	if((fp=fopen("employee.txt","r"))==NULL)
		return;;
	printf("??????:\n");
	printf("???	????	???	????	?????		??????	????��\n");
	for(i=0;fread(&em[i],LEN,1,fp)!=0;i++)//???????????????
	{
		printf("%d\t",em[i].order);
		printf("%s\t",em[i].name);
		printf("%s\t",em[i].sex);
		printf("%d\t",em[i].age);
		printf("%s\t",em[i].identity);
		printf("%s\t",em[i].location);
		printf("%d\t\n",em[i].phone);
	}
	getch(); 
	fclose(fp);
	menustrip();
}
